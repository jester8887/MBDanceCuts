<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Circus Mix Versions</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
  <style>
    :root { --bg:#f4f4f4; --card:#fff; --ink:#111; --sub:#666; --ring:rgba(0,0,0,.08); }
    * { box-sizing: border-box; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; color:var(--ink); background:var(--bg); }
    header { text-align:center; padding:28px 16px 12px; }
    h1 { margin:0 0 6px; font-size: clamp(22px, 3vw, 32px); }
    .wrap { max-width: 820px; margin: 0 auto; padding: 0 16px 40px; }

    .card {
      background: var(--card);
      border-radius: 14px;
      padding: 16px;
      margin: 14px 0;
      box-shadow: 0 2px 8px var(--ring);
      border: 1px solid rgba(0,0,0,.04);
    }
    .row { display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap; }
    .title { font-weight: 700; font-size: 16px; line-height:1.3; }
    .sub { color: var(--sub); font-size: 13px; }
    .meta { display:flex; gap:10px; align-items:center; }
    .btn {
      cursor:pointer; border:1px solid rgba(0,0,0,.12); background:#fff;
      padding:8px 12px; border-radius: 10px; font-size:13px;
    }
    .btn:active { transform: translateY(1px); }
    .wave {
      position:relative;
      height: 84px;
      margin: 12px 0 6px;
      border-radius: 10px;
      overflow:hidden;
      background: #fafafa;
      border:1px solid rgba(0,0,0,.06);
    }
    .audio {
      width:100%;
      margin-top: 10px;
    }
    .dur { font-variant-numeric: tabular-nums; }
  </style>
</head>
<body>
  <header>
    <h1>Circus Mix Versions</h1>
    <div class="sub">Waveform preview + HTML5 audio players</div>
  </header>

  <div class="wrap" id="list"></div>

  <link rel="preconnect" href="https://unpkg.com">
  <script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>
  <script src="https://unpkg.com/wavesurfer.js@7"></script>

  <script>
    const toRaw = (u) => {
      try {
        const url = new URL(u);
        url.searchParams.set('raw', '1');
        return url.toString();
      } catch { return u; }
    };

    const tracks = [
      {
        title: "Version 4a - Longer Pause + Lion",
        url: "https://www.dropbox.com/scl/fi/k3yal1vv2u8voxuhnvkxc/Circus-4d-Shorter-Pause.mp3?rlkey=oquvybsfm0j3x63lz385bifod&st=z4mo3f1d&dl=0"
      },
      {
        title: "Version 4b - Longer Pause - No Lion",
        url: "https://www.dropbox.com/scl/fi/rzc3z3ikvs68e0m8nzkfx/Circus-4c-Shorter-Pause-Lion.mp3?rlkey=hkybp5xdgu3ck7zn0g13tu3hg&st=b1w3cx65&dl=0"
      },
      {
        title: "Version 4c - Shorter Pause + Lion",
        url: "https://www.dropbox.com/scl/fi/cgbzmey4feh6ugkseuw4p/Circus-4b-Longer-Pause.mp3?rlkey=o5sb7o8b4eb4e1zx98r9kpv75&st=j95nvx08&dl=0"
      },
      {
        title: "Version 4d - Shorter Pause - No Lion",
        url: "https://www.dropbox.com/scl/fi/2g1u5qxfmx9codkeokdvm/Circus-4a-Longer-Pause-Lion.mp3?rlkey=pf47iaafu5t6a4eiq8utv6lgy&st=bev43g0n&dl=0"
      }
    ].map(t => ({ ...t, url: toRaw(t.url) }));

    const list = document.getElementById('list');

    tracks.forEach((t, i) => {
      const card = document.createElement('section');
      card.className = 'card';
      card.innerHTML = `
        <div class="row">
          <div>
            <div class="title">${t.title}</div>
            <div class="sub"><span class="dur" id="dur-${i}">--:--</span></div>
          </div>
          <div class="meta">
            <button class="btn" id="play-${i}">Play</button>
          </div>
        </div>
        <div class="wave" id="wave-${i}"></div>
        <audio class="audio js-player" id="audio-${i}" preload="metadata" controls>
          <source src="${t.url}" type="audio/mpeg">
        </audio>
      `;
      list.appendChild(card);
    });

    const plyrPlayers = Plyr.setup('.js-player');

    const surfers = tracks.map((t, i) => {
      const ws = WaveSurfer.create({
        container: `#wave-${i}`,
        url: t.url,
        height: 84,
        minPxPerSec: 80,
        progressColor: '#999',
        waveColor: '#dcdcdc',
        cursorWidth: 1,
        dragToSeek: true,
        interact: true,
      });

      const audioEl = document.getElementById(`audio-${i}`);
      const btn = document.getElementById(`play-${i}`);
      const durEl = document.getElementById(`dur-${i}`);

      ws.on('ready', () => {
        const d = ws.getDuration();
        if (isFinite(d)) durEl.textContent = formatTime(d);
      });

      ws.on('play', () => btn.textContent = 'Pause');
      ws.on('pause', () => btn.textContent = 'Play');

      btn.addEventListener('click', () => ws.playPause());

      audioEl.addEventListener('play', () => {
        if (!ws.isPlaying()) ws.play();
      });
      audioEl.addEventListener('pause', () => {
        if (ws.isPlaying()) ws.pause();
      });
      audioEl.addEventListener('seeked', () => {
        ws.setTime(audioEl.currentTime || 0);
      });

      return ws;
    });

    function formatTime(sec) {
      const s = Math.floor(sec % 60).toString().padStart(2, '0');
      const m = Math.floor(sec / 60).toString();
      return `${m}:${s}`;
    }
  </script>
</body>
</html>
