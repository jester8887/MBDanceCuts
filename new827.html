<!DOCTYPE html>
<html lang="en">
<head>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-CG99TYH350"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-CG99TYH350');
  </script>
  <meta charset="UTF-8" />
  <title>Mixes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
  <style>
    :root { --bg:#f4f4f4; --card:#fff; --ink:#111; --sub:#666; --ring:rgba(0,0,0,.08); }
    * { box-sizing: border-box; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; color:var(--ink); background:var(--bg); }
    header { text-align:center; padding:28px 16px 12px; }
    h1 { margin:0 0 6px; font-size: clamp(22px, 3vw, 32px); }
    .wrap { max-width: 820px; margin: 0 auto; padding: 0 16px 40px; }

    .card {
      background: var(--card);
      border-radius: 14px;
      padding: 16px;
      margin: 14px 0;
      box-shadow: 0 2px 8px var(--ring);
      border: 1px solid rgba(0,0,0,.04);
      user-select: none;
      -webkit-user-drag: none;
    }
    .row { display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap; }
    .title { font-weight: 700; font-size: 16px; line-height:1.3; }
    .sub { color: var(--sub); font-size: 13px; }
    .meta { display:flex; gap:10px; align-items:center; }
    .btn {
      cursor:pointer; border:1px solid rgba(0,0,0,.12); background:#fff;
      padding:8px 12px; border-radius: 10px; font-size:13px;
    }
    .btn:active { transform: translateY(1px); }
    .wave {
      position:relative;
      height: 84px;
      margin: 12px 0 6px;
      border-radius: 10px;
      overflow:hidden;
      background: #fafafa;
      border:1px solid rgba(0,0,0,.06);
    }
    .audio {
      width:100%;
      margin-top: 10px;
    }
    .dur { font-variant-numeric: tabular-nums; }
    .no-rightclick { position:absolute; inset:0; background:transparent; }
    footer { text-align:center; margin:40px 0; font-size:15px; }
    footer a { color:#0077cc; text-decoration:none; }
    footer a:hover { text-decoration:underline; }

    .feedback-link {
      display:block;
      text-align:center;
      padding:12px;
      background:#fff3cd;
      border-bottom:1px solid #e0c97f;
      font-size:15px;
    }
    .feedback-link a {
      color:#b36b00;
      text-decoration:none;
      font-weight:600;
    }
    .feedback-link a:hover {
      text-decoration:underline;
    }
  </style>
</head>
<body>
  <div class="feedback-link">
    <a href="https://docs.google.com/forms/d/e/1FAIpQLSfwRDCZsM3Vp6RNoMaV5qmWm0xqSE_jLLkJAJ-LojPxSNPnLw/viewform?usp=header" target="_blank">
      Don't hear what you want to hear? Fill out my short form anonymously, and let me know why!
    </a>
  </div>

  <header>
    <h1>Mixes</h1>
  </header>

  <div class="wrap" id="list"></div>

  <footer>
    <a href="https://jester8887.github.io/MBDanceCuts/testnew.html">View the rest of my mixes here!</a>
  </footer>

  <link rel="preconnect" href="https://unpkg.com">
  <script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>
  <script src="https://unpkg.com/wavesurfer.js@7/dist/wavesurfer.min.js"></script>

  <script>
    // Force Dropbox links to stream (dl=1)
    const toDirect = (u) => {
      try {
        const url = new URL(u);
        url.searchParams.set('dl', '1');
        url.searchParams.delete('raw');
        return url.toString();
      } catch {
        return u;
      }
    };

    const tracks = [
      { title: "Lil Wayne Mix $35", url: "https://www.dropbox.com/scl/fi/pn79lu7o1kax37q7hjitm/Lil-Wayne-Mix-V1.mp3?rlkey=s9itecx47q6t2f1ds0eu7it9j&st=cdd8amlk&dl=0" },
      { title: "Pitbull Mix $35",   url: "https://www.dropbox.com/scl/fi/kvo90llehckwgyznmxwuk/Pitbull-MZ-V2-2m53s.mp3?rlkey=iev6g8ozgr5hzgtf9q8wql4ck&st=db7q2olz&dl=0" },
      { title: "KPop Demon Hunters Mix INTRO SPECIAL $30 - Limited", url: "https://www.dropbox.com/scl/fi/5gb1rw78huwcode6a38ao/KPop-Demon-Hunters-Mix-2-MGB.mp3?rlkey=1kyrv79rxjp2rcd3qjboj1yuu&st=mb6akim1&dl=0" },
      { title: "KPop Demon Hunters Mix 2 (Shorter)", url: "https://www.dropbox.com/scl/fi/cps44yp2n8wcdq05o42t4/KPop-Demon-Hunters-Mix-3-MGB.mp3?rlkey=9txypngmkgkmqe7at7ubvudxf&st=yogubhrj&dl=0" }
    ].map(t => ({ ...t, url: toDirect(t.url) }));

    const list = document.getElementById('list');

    // Render cards
    tracks.forEach((t, i) => {
      const card = document.createElement('section');
      card.className = 'card';
      card.innerHTML = `
        <div class="row">
          <div>
            <div class="title">${t.title}</div>
            <div class="sub"><span class="dur" id="dur-${i}">--:--</span></div>
          </div>
          <div class="meta">
            <button class="btn" id="play-${i}">Play</button>
          </div>
        </div>
        <div class="wave" id="wave-${i}">
          <div class="no-rightclick"></div>
        </div>
        <audio class="audio js-player" id="audio-${i}" preload="metadata" controls controlsList="nodownload"></audio>
      `;
      list.appendChild(card);

      // Set audio src
      const audioEl = document.getElementById(`audio-${i}`);
      audioEl.src = t.url;

      // Disable right-click/save
      ['contextmenu','dragstart','mousedown','pointerdown'].forEach(evt => {
        audioEl.addEventListener(evt, e => {
          if (evt === 'contextmenu' || e.button === 2) e.preventDefault();
        });
      });
    });

    // Plyr controls
    const plyrPlayers = Plyr.setup('.js-player', { controls: ['play','progress','current-time','mute','volume'] });

    // WaveSurfer waveforms
    const surfers = tracks.map((t, i) => {
      const ws = WaveSurfer.create({
        container: `#wave-${i}`,
        url: t.url,
        height: 84,
        minPxPerSec: 80,
        progressColor: '#999',
        waveColor: '#dcdcdc',
        cursorWidth: 1,
        dragToSeek: true,
        interact: true
      });

      const audioEl = document.getElementById(`audio-${i}`);
      const btn = document.getElementById(`play-${i}`);
      const durEl = document.getElementById(`dur-${i}`);

      ws.on('ready', () => {
        const d = ws.getDuration();
        if (isFinite(d)) durEl.textContent = formatTime(d);
      });

      ws.on('play', () => btn.textContent = 'Pause');
      ws.on('pause', () => btn.textContent = 'Play');

      btn.addEventListener('click', () => ws.playPause());

      audioEl.addEventListener('play', () => { if (!ws.isPlaying()) ws.play(); });
      audioEl.addEventListener('pause', () => { if (ws.isPlaying()) ws.pause(); });
      audioEl.addEventListener('seeked', () => ws.setTime(audioEl.currentTime || 0));

      const overlay = document.querySelector(`#wave-${i} .no-rightclick`);
      ['contextmenu','dragstart','mousedown','pointerdown'].forEach(evt => {
        overlay.addEventListener(evt, e => { if (evt === 'contextmenu' || e.button === 2) e.preventDefault(); }, { passive:false });
      });

      return ws;
    });

    document.getElementById('list').addEventListener('contextmenu', e => e.preventDefault());

    function formatTime(sec) {
      const s = Math.floor(sec % 60).toString().padStart(2, '0');
      const m = Math.floor(sec / 60).toString();
      return `${m}:${s}`;
    }
  </script>
</body>
</html>
